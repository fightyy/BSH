source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
devtools::session_info()
sessionInfo()
source("~/project/BSH_figure/figure1/figure1.R")
source("~/project/BSH_figure/figure1/figure1.R")
gc()
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
source("~/project/BSH_figure/figure2/figure2.R")
#figure2i----
#Distribution of the Silhouette values across all patients
df <- read_csv("../data/fig2_result_boundary_real.csv")
ggplot(df, aes(x = silhouette_mean)) +
geom_histogram(
aes(y = after_stat(count)),
binwidth = 0.1,
boundary = 0,
fill = "#1f77b4", color = "black"
) +
labs(
x = "Silhouette value",
y = "Count"
) +
my_theme()+
theme(
axis.text.x = element_text(size = 6)
)
ggsave("figure2i.pdf", unit="cm", width=6, height=5, dpi=300)
View(df)
gc()
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
source("~/project/BSH_figure/figure3/figure3.R")
gc()
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
#plot
ggplot(df_score_enn, aes(x = value_enn, y = GO_0098742_score)) +
geom_point(color="#1f77b4",size = 1, alpha = 0.5) +
geom_smooth(method = "lm", se = T,linewidth = 0.8, color = "red", linetype = 2) +
annotate("text", x = mean(range(df_score_enn$value_enn)), y = max(df_score_enn$GO_0098742_score),
label = text_label_str, parse = TRUE,
size = 7/.pt, fontface = "plain", hjust = 0.5, family="Arial") +
labs(
x = expression(ENN[MN]),
y = "GSVA score (GO:0098742)",
title = "HCC"
)+
my_theme()+
theme(
legend.position = "none")
ggsave("figure4g.pdf", width=5, height=5, units="cm", dpi = 300)
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
#plot tree
rpar <- readRDS(paste0("../data/csv_example/", title, "_tree.rds"))
genetic_cluster <- get_CH_index(rpar)
group <- genetic_cluster$Genetic_group
annotation <- data.frame(label=names(group),group=as.character(group),sample=names(group))
rpar1 <- drop.tip(rpar, "GL")
annotation2 <- annotation %>%
left_join(annotated %>% dplyr::select(sample, location), by = "sample")
###figure4h-4j----
#figure4h:A neutrally evolving tumor simulated using the boundary growth model
#figure4i:The phylogenetic tree of the sampled sectors from the simulation in figure4h
#figure4j:The spatial distribution of the genetic classes for the tumor in panel figure4h
#code comment see figure4a-4c
tree_color <- c("#F8766D","#00BFC4","#C77CFF","#7CAE00","#3288BD", "#FFFFBF","#FDAE61", "#9E0142","#5E4FA2")
colormap=rev(RColorBrewer::brewer.pal(11,'Spectral'))
work_dir <- "../data/csv_example"
filename <- "hu_scoef0_death0.3_adv0_pushprob0_mutrate0.6_sample16vaf_cutoff0_seed5_deme_vaf.txt"
state <- "Boundary growth"
s_coef         <- str_extract(filename, "(?<=scoef)\\d+(\\.\\d+)?") %>% as.numeric()
death_rate     <- str_extract(filename, "(?<=death)\\d+(\\.\\d+)?") %>% as.numeric()
adv_rate <- str_extract(filename, "(?<=adv)[+-]?\\d+(\\.\\d+)?([eE][+-]?\\d+)?") %>% as.numeric()
push_prop      <- str_extract(filename, "(?<=pushprob)\\d+(\\.\\d+)?") %>% as.numeric()
mutation_rate  <- str_extract(filename, "(?<=mutrate)\\d+(\\.\\d+)?") %>% as.numeric()
sample_diameter<- str_extract(filename, "(?<=sample)\\d+(?=vaf)") %>% as.numeric()
vaf_cutoff     <- str_extract(filename, "(?<=cutoff)\\d+(\\.\\d+)?") %>% as.numeric()
seed     <- str_extract(filename, "(?<=seed)\\d+(\\.\\d+)?") %>% as.numeric()
r <- (200/2)
lambda_b <- 1-death_rate
push_power <- r*push_prop
birth_rate <- (1+s_coef)*lambda_b+death_rate
title <- paste0("fig4_hu_","scoef", s_coef, "_death", death_rate, "_adv", adv_rate, "_pushprob", push_prop, "_mutrate", mutation_rate, "_sample", sample_diameter, "vaf_cutoff", vaf_cutoff ,"_seed",  seed )
dir <- sprintf("scoef%.2f_death%.2f_adv%.2f_pushprob%.2f_mutrate%.2f_sample%.0f_vaf%.2f", s_coef, death_rate, adv_rate, push_prop, mutation_rate, sample_diameter, vaf_cutoff)
Sim_data = read.table(file = paste0(work_dir, "/", title,"_deme_vaf.txt"), header = T, stringsAsFactors = F)
boundary_strength = read_csv(file = paste0(work_dir, "/", title,"_result_boundary.csv"))
location = read.table(file = paste0(work_dir, "/", title,"_deme_location.txt"), header = T)
all_location = read.table(file = paste0(work_dir, "/", "fig4_snapshot_dim3_pushrandom_", title,"_prop8_8.txt"), header = T)
x_rng <- range(all_location$x)
y_rng <- range(all_location$y)
max_distance <- sqrt((x_rng[2] - x_rng[1])^2 + (y_rng[2] - y_rng[1])^2)
boundary <- all_location %>%
group_by(y) %>%
summarise(
x_min = min(x),
x_max = max(x),
.groups = "drop"
)
boundary_pts <- bind_rows(
boundary %>% transmute(x = x_min, y),
boundary %>% transmute(x = x_max, y)
)
#Calculate the minimum distance from each sample to all boundary points
sample_pts <- location %>% dplyr::select(sample, x, y)
min_distances <- sample_pts %>%
rowwise() %>%
mutate(
min_distance = min(sqrt((x - boundary_pts$x)^2 + (y - boundary_pts$y)^2))
) %>%
ungroup()
annotated <- min_distances %>%
mutate(
location = ifelse(min_distance > 0.25 * max_distance, "center", "edge"),
max_distance = max_distance)
#plot tree
rpar <- readRDS(paste0("../data/csv_example/", title, "_tree.rds"))
genetic_cluster <- get_CH_index(rpar)
group <- genetic_cluster$Genetic_group
annotation <- data.frame(label=names(group),group=as.character(group),sample=names(group))
rpar1 <- drop.tip(rpar, "GL")
annotation2 <- annotation %>%
left_join(annotated %>% dplyr::select(sample, location), by = "sample")
xmax <- max(phytools::nodeHeights(rpar1))
scale_width <- 150
tree_plot <- ggtree(rpar1) %<+% annotation2 +
geom_tippoint(aes(color = location), shape = 16, size = 10/.pt) +
geom_treescale(x = xmax - scale_width + 10, y = 0, width = scale_width, fontsize = 6/.pt)+
geom_text2(aes(label = sample), size = 4/.pt, color = "white") +
scale_color_manual(values = c(center = "#E64B35FF", edge = "#1f77b4"),
labels=c("center" = "Center", "edge" = "Edge"),
name = "Location") +
geom_rootedge(rootedge = rpar$edge.length[length(rpar$edge.length)]) +
geom_rootpoint() +
coord_cartesian(clip = "off") +
labs(title = "Tree") +
my_theme() +
theme(
axis.line       = element_blank(),
axis.ticks      = element_blank(),
axis.text.x     = element_blank(),
axis.text.y     = element_blank(),
axis.title.x    = element_blank(),
axis.title.y    = element_blank(),
legend.position = "right",
legend.box.margin = margin(t = -0.5, unit = "cm")
)
ggsave("figure4g.pdf", unit="cm", width=4, height=5,dpi = 300)
#plot ITH
loc_genetic_cluster <- data.frame()
for(sample_ in location$sample){
cluster <- as.character(genetic_cluster$Genetic_group[[sample_]])
coord_vec <- location %>% filter(sample == sample_) %>% dplyr::select(x,y,z)
x <- coord_vec[["x"]]
y <- coord_vec[["y"]]
z <- coord_vec[["z"]]
small_df <- data.frame(X=x, Y=y, Z=z, cluster=cluster, sample=sample_)
rownames(small_df) <- sample_
loc_genetic_cluster <- rbind(loc_genetic_cluster, small_df)
}
cluster_num <- length(unique(loc_genetic_cluster$cluster))
select_info <- loc_genetic_cluster[c("X","Y")]
ITH_matrix <- get_ITH_matrix(phy_data,select_info,r)
ITH_matrix <- get_ITH_matrix(phy_data,select_info,r)
select_info
phy_data
r
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
source("~/project/BSH_figure/figure4/figure4.R")
gc()
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
###figure5h----
#Proportion of sectors that are tested positive for natural selection (y-axis) when simulating neutrally evolving tumors.
#Comparison between sectors that are at the tumor periphery and those that are the tumor interior
df <- read_csv("../data/fig5_mob_single_window_neutral.csv") %>% filter(mobster_test_type == "single")
df_outline <- read_csv("../data/fig5_result_center_edge_all0.25.csv") %>% dplyr::select(sample, seed, location)
df_summary <- df %>% left_join(df_outline, by=c("sample"="sample", "seed"="seed")) %>%
group_by(seed, location) %>% summarise(selected_prop = mean(mobster_result_vec == "selected"),.groups = "drop") %>%
mutate(outline=ifelse(location == "edge", "edge", "center"))
p <- ggplot(df_summary, aes(x = outline, y = selected_prop, fill=outline)) +
geom_boxplot(outlier.shape = NA) +
labs(x = NULL, y = "Proportion of \nselected region detected by MOBSTER", title="Single sample (neutral)") +
stat_compare_means(method = "wilcox.test",
label = "p.signif",
comparisons = list(c("center", "edge")),
size = 7 / .pt)+
scale_fill_manual(values = c("edge" = "#E69F00", "center" = "#56B4E9")) +
scale_x_discrete(labels=c("edge"="Edge","center"="Center" ))+
ylim(0,0.7)+
my_theme()+
theme(
legend.position = "none"
)
###figure5h----
#Proportion of sectors that are tested positive for natural selection (y-axis) when simulating neutrally evolving tumors.
#Comparison between sectors that are at the tumor periphery and those that are the tumor interior
df <- read_csv("../data/fig5_mob_single_window_neutral.csv") %>% filter(mobster_test_type == "single")
df_center_edge <- read_csv("../data/fig5_result_center_edge_all0.25.csv") %>% dplyr::select(location, sample)
df_all <- df %>% left_join(df_center_edge, by=c("Punch"="sample")) %>% dplyr::select(mobster_result, patient, Punch, location)
df
###figure5h----
#Proportion of sectors that are tested positive for natural selection (y-axis) when simulating neutrally evolving tumors.
#Comparison between sectors that are at the tumor periphery and those that are the tumor interior
df <- read_csv("../data/fig5_mob_boundary_real_data.csv") %>% filter(mobster_test_type == "single")
df_center_edge <- read_csv("../data/fig5_result_center_edge_all0.25.csv") %>% dplyr::select(location, sample)
df_all <- df %>% left_join(df_center_edge, by=c("Punch"="sample")) %>% dplyr::select(mobster_result, patient, Punch, location)
###center edge
df_prop <- df_all %>%
group_by(patient, location) %>%
summarise(
selected_prop = mean(mobster_result == "selected"),
.groups = "drop"
)
ggplot(df_prop, aes(x = location, y = selected_prop, fill = location)) +
geom_boxplot(outlier.shape = NA) +
stat_compare_means(
comparisons = list(c("center", "edge")),
method = "wilcox.test",
label = "p.signif",
size = 6 / .pt
) +
scale_fill_manual(values = c("center" = "#E69F00", "edge" = "#56B4E9")) +
scale_x_discrete(labels=c("center" = "Center", "edge" = "Edge"))+
labs(
title = "Single sample",
x = "",
y = "Proportion of selected samples"
) +
ylim(0,1.1)+
my_theme() +
theme(
legend.position = "none",
plot.margin = margin(1,0,-5,0)
)
ggsave("figure5h.pdf",unit="cm", width=5, height=5,dpi = 300)
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
source("~/project/BSH_figure/figure5/figure5.R")
df_long
df_summary
df
View(df)
#figure5l----
#Proportion of sectors that are tested positive for natural selection for samples near block boundary and within block for HCC and LUAD
df <- read_csv("../data/fig5_mob_boundary_real_data.csv")
df1 <- df %>%
mutate(
boundary_flag = case_when(
is.logical(boundary) ~ boundary,
is.numeric(boundary) ~ boundary != 0,
TRUE ~ tolower(as.character(boundary)) %in% c("true","t","1","yes","y")
),
selected_flag = mobster_result == "selected")
df_summary <- df1 %>%
group_by(patient, input_type) %>%
summarise(
n_boundary              = sum(boundary_flag, na.rm = TRUE),
n_nonboundary           = sum(!boundary_flag, na.rm = TRUE),
boundary_selected       = sum(selected_flag &  boundary_flag, na.rm = TRUE),
nonboundary_selected    = sum(selected_flag & !boundary_flag, na.rm = TRUE),
boundary_selected_ratio    = ifelse(n_boundary > 0,    boundary_selected    / n_boundary,    NA_real_),
nonboundary_selected_ratio = ifelse(n_nonboundary > 0, nonboundary_selected / n_nonboundary, NA_real_),
.groups = "drop"
) %>%
mutate(
tumor_type = ifelse(grepl("DT", patient),
"liver_cancer", "lung_cancer"))
df_long <- df_summary %>%
pivot_longer(
c(boundary_selected_ratio, nonboundary_selected_ratio),
names_to  = "boundary_type",
values_to = "selected_ratio"
) %>%
mutate(
boundary = factor(ifelse(boundary_type == "boundary_selected_ratio", "Boundary", "Non-boundary"),
levels = c("Non-boundary", "Boundary"))
)
df_long_plot <- df_long %>% mutate(boundary=ifelse( boundary == "Boundary", "block boundary", "block interior"))
p <- ggplot(df_long_plot , aes(x = boundary, y = selected_ratio, fill = boundary)) +
geom_boxplot(outlier.shape = NA) +
labs(x = NULL, y = "Proportion of selected\nregion detected by MOBSTER", title="Single sample") +
scale_fill_manual(values = c("block boundary" = "#E69F00", "block interior" = "#56B4E9")) +
scale_x_discrete(labels=c("block boundary" = "Block\nboundary", "block interior" = "Block\ninterior"))+
theme(legend.position = "none",
strip.background = element_rect(fill = "grey90"),
plot.title = element_text(hjust = 0.5, face = "bold")) +
stat_compare_means(method = "wilcox.test",
label = "p.signif",
label.y = 1,
comparisons = list(c("block boundary", "block interior")),
size = 6 / .pt) +
ylim(0,1.1)+
my_theme()+
theme(
legend.position = "none",
strip.text = element_text(size=7),
plot.title = element_text(face="plain")
)
ggsave("figure5l.pdf",unit="cm", width=3.5, height=4,dpi = 300)
##figure5m----
#Proportion of windows that are tested positive for natural selection for composite samples with mixed genetic class (i.e. mixed)
#and pure genetic class (i.e. pure) for HCC and LUAD respectively.
df <- read_csv("../data/fig5_mob_pileup_result_ccf_vaf_window_single.csv")
df_summary <- df %>%
mutate(type_combo = paste(sample_type, mobster_result)) %>% filter(mobster_test_type == "window", input_type == "ccf_mean") %>%
group_by(patient, grid_dist) %>%
summarise(
pure_select   = sum(type_combo == "pure selected"),
mixed_select  = sum(type_combo == "mixed selected"),
pure_neutral    = sum(type_combo == "pure neutral"),
mixed_neutral   = sum(type_combo == "mixed neutral"),
.groups = "drop"
) %>% filter(grid_dist != -1 , grid_dist != "grid_dist")
df2 <- df_summary %>%
mutate(
mixed_denom = mixed_select + mixed_neutral,
pure_denom  = pure_select  + pure_neutral,
mixed_prop  = ifelse(mixed_denom > 0, mixed_select / mixed_denom, NA_real_),
pure_prop   = ifelse(pure_denom  > 0, pure_select  / pure_denom,  NA_real_)
) %>%
dplyr::select(patient, grid_dist, mixed_prop, pure_prop, ) %>% na.omit() %>%
mutate(tumor_type = ifelse(grepl("DT", patient), "liver_cancer", "lung_cancer"))
df_long <- df2 %>%
pivot_longer(cols = c(mixed_prop, pure_prop),
names_to = "prop_type",
values_to = "value")
df_long_plot <- df_long %>% filter(grid_dist == 0.75) %>% mutate(prop_type = ifelse(prop_type== "mixed_prop", "mixed region", "pure region"))
p2 <- ggplot(df_long_plot, aes(x = prop_type, y = value, fill = prop_type)) +
geom_boxplot() +
stat_compare_means(
comparisons = list(c("mixed region", "pure region")),
method = "wilcox.test",
size = 6 / .pt,
label = "p.signif"
) +
scale_fill_manual(values = c("mixed region" = "#E69F00", "pure region" = "#56B4E9")) +
scale_x_discrete(labels=c("mixed region" = "Mixed\nregion", "pure region" = "Pure\nregion"))+
labs(x = NULL, y = "Proportion of selected \nregion detected by MOBSTER", title="Sliding window") +
ylim(0,1.15)+
my_theme()+
theme(
legend.position = "none",
strip.text = element_text(size=7),
plot.title = element_text(face="plain")
)
ggsave("figure5m.pdf",unit="cm", width=3.5, height=4,dpi = 300)
###figure5n----
df <- read_csv("../data/fig5_mob_boundary_real_data.csv")
df1 <- df %>%
mutate(
boundary_flag = case_when(
is.logical(boundary) ~ boundary,
is.numeric(boundary) ~ boundary != 0,
TRUE ~ tolower(as.character(boundary)) %in% c("true","t","1","yes","y")
),
selected_flag = mobster_result == "selected"
)
df_center_edge <- read_csv("../data/fig5_result_center_edge_all0.25.csv") %>% dplyr::select(location, sample)
df_all <- df1 %>% left_join(df_center_edge, by=c("Punch"="sample")) %>% dplyr::select(mobster_result, patient, Punch, location)
df_long_plot <- df_long %>% filter(input_type %in% c("ccf_mean")) %>% mutate(boundary=ifelse( boundary == "Boundary", "block boundary", "block interior"))
df_prop <- df_all %>%
group_by(patient, location) %>%
summarise(
selected_prop = mean(mobster_result == "selected"),
.groups = "drop"
)
ggplot(df_prop, aes(x = location, y = selected_prop, fill = location)) +
geom_boxplot(outlier.shape = NA) +
stat_compare_means(
comparisons = list(c("center", "edge")),
method = "wilcox.test",
label = "p.signif",
size = 6 / .pt
) +
scale_fill_manual(values = c("center" = "#E69F00", "edge" = "#56B4E9")) +
scale_x_discrete(labels=c("center" = "Center", "edge" = "Edge"))+
labs(
title = "Single sample",
x = "",
y = "Proportion of selected samples"
) +
ylim(0,1.1)+
my_theme() +
theme(
legend.position = "none",
plot.margin = margin(1,0,-5,0)
)
ggsave("figure5n.pdf",unit="cm", width=3, height=4,dpi = 300)
##figure5o----
#dN/dS values calculated for sectors testing positive for natural selection (i.e. selected sample) as well as testing negative
df_dnds <- read_csv("../data/fig5_result_dnds_singles_sample.csv")
df_mobster <- read_csv("mob_pileup_result_ccf_vaf_window_single.csv")
df_mobster_single <- df_mobster %>% filter(sample_type == "one_sample", input_type=="ccf_mean") %>%
mutate(samples = gsub("LUAD", "", samples))
df_dnds_all <- df_dnds %>% filter(name == "wall") %>% na.omit()
df_mobster_dnds <- df_dnds_all %>% left_join(df_mobster_single, by=c("SampleID" = "samples")) %>% na.omit()
comparisons_list <- list(c("selected", "neutral"))
##figure5o----
#dN/dS values calculated for sectors testing positive for natural selection (i.e. selected sample) as well as testing negative
df_dnds <- read_csv("../data/fig5_result_dnds_singles_sample.csv")
df_mobster <- read_csv("../data/mob_pileup_result_ccf_vaf_window_single.csv")
df_mobster_single <- df_mobster %>% filter(sample_type == "one_sample", input_type=="ccf_mean") %>%
mutate(samples = gsub("LUAD", "", samples))
##figure5o----
#dN/dS values calculated for sectors testing positive for natural selection (i.e. selected sample) as well as testing negative
df_dnds <- read_csv("../data/fig5_result_dnds_singles_sample.csv")
df_mobster <- read_csv("../data/fig5_mob_pileup_result_ccf_vaf_window_single.csv")
df_mobster_single <- df_mobster %>% filter(sample_type == "one_sample", input_type=="ccf_mean") %>%
mutate(samples = gsub("LUAD", "", samples))
df_dnds_all <- df_dnds %>% filter(name == "wall") %>% na.omit()
df_mobster_dnds <- df_dnds_all %>% left_join(df_mobster_single, by=c("SampleID" = "samples")) %>% na.omit()
comparisons_list <- list(c("selected", "neutral"))
ggplot(df_mobster_dnds, aes(x=mobster_result, y=mle, fill=mobster_result)) +
geom_boxplot(outlier.shape =NA) +
stat_compare_means(
comparisons = comparisons_list,
method = "wilcox.test",
paired = FALSE,
label = "p.signif",
size = 6 / .pt
) + scale_fill_manual(values = c("selected" = "#E69F00", "neutral" = "#56B4E9")) +
scale_x_discrete(labels=c("selected" = "Selected\nsample", "neutral"="Neutral\nsample"))+
labs(
x = NULL,
y = expression( italic(d["N"]/d["S"]) )
)+
ylim(0.5,1.7)+
my_theme()+
theme(
legend.position = "none")
ggsave("figure5p.pdf",unit="cm", width=3.5, height=4,dpi = 300)
